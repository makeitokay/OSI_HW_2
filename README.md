# ИДЗ по ОС №2 / Вариант №24
## Васильев Андрей Михайлович / БПИ215

Работа выполнена с соблюдением всех критериев на **6 БАЛЛОВ**.

## Условие задачи

Задача о наследстве. У старого дона Энрике было два сына, у каждого из сыновей – еще по два сына, каждый из которых имел 8 еще по два сына. Умирая, дон Энрике завещал все свое богатство
правнукам в разных долях. Адвокат дон Хосе выполнил задачу
дележа наследства в меру своих способностей. Правнуки заподозрили адвоката в укрывательстве части наследства или его некорректном перераспределении. Требуется создать приложение,
которое при известных сумме завещания дона Энрике и
доле каждого наследника, проверяет честность адвоката. При решении использовать принцип дихотомии. Примечание.
Необходимо учесть изощренный ум адвоката, который может не
только присваивать себе часть суммы, но и выполнять другие манипуляции с суммой наследства. Но так как наследники знают свою
долю и полученную сумму, они всегда могут вывести адвоката на
чистую воду. Дихотомия подразумевает иерархическое порождение процессов и обратную свертку промежуточных результатов
в единую точку.

## Аргументы командной строки

Первый аргумент - сумма наследства
Следующие 8 аргументов - доли для соответствующего наследника
Пример: 10 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.3

## 4 балла

```bash
gcc 4.c -lrt -lpthread
./a.out 10 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.3
```
Программа работает следующим образом:
1. Считываются аргументы командной строки
2. Инициализируется массив разделяемой памяти и семафоры для каждого наследника
3. В цикле по наследникам создается дочерний процесс, в котором адвокат распределяет наследство. Распределение происходит следующим образом:
   1. Блокируется семафор i-го наследника
   2. Генерируется рандомное число от 0 до 9. Если число больше или равно 8 (шанс 20%), адвокат поступает нечестно.
      1. Генерируется еще одно рандомное число от 0 до 1. Если число равно 0 (шанс 50%), то адвокат забирает половину наследства i-го наследника себе.
      2. Если число равно 1 (шанс 50%), то рандомно генерируем другого наследника (не равного i), которому отдадим часть наследства. Блокируем семафор этого наследника, проверяем, если наследство для него уже было распределено, то отдаем ему половину наследства i-го наследника. В противном случае поступаем честно, так как для него еще не было распределения. Затем отпускаем семафор для другого наследника.
   3. Если число меньше 8 (шанс 80%), то адвокат поступает честно и распределяет наследство для i-го наследника в соответствии с его долей.
   4. Отпускается семафор для i-го наследника.
4. Затем в цикле каждый наследник проверит итоговое распределение адвоката на соответствие назначенной доле. В консоль будут выведены сообщения с результатами проверки.
5. В конце программы освобождаются ресурсы.

Программа на 4 балла использует разделяемую память и семафоры POSIX.

![1](https://user-images.githubusercontent.com/34311075/233860889-e5846b9a-595f-43ed-b89c-26f4696d82f7.png)

## 5 баллов

```bash
gcc 5.c -lrt -lpthread
./a.out 10 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.3
```

Алгоритм программы такой же, как в программе на 4 балла.

Программа на 5 баллов использует неименованные семафоры в разделяемой памяти POSIX.

![2](https://user-images.githubusercontent.com/34311075/233860904-35c418ec-f3fc-41d6-94ad-252ae4c73b4f.png)

## 6 баллов

```bash
gcc 6.c -lrt -lpthread
./a.out 10 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.3
```

Алгоритм программы такой же, как в программе на 4 и 5 баллов.

Программа на 6 баллов использует семафоры и разделяемую память UNIX SYSTEM V.

![3](https://user-images.githubusercontent.com/34311075/233860912-50d0be3f-94e3-4962-b8b8-1a32e446f729.png)
